<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head  th:replace="fragments/head :: headerFragment">
<meta charset="ISO-8859-1">
<title>mock test  </title>
</head>
<body bgcolor="FloralWhite">
<div class="header">
<div align="right">
<p id="timerValue"></p></div>
<div align="center">
	<h1 th:text="${exam.getName()} "> exam name</h1>
	
			Level:- <span th:text="${exam.getLevel()} ">level</span><br>&nbsp;&nbsp; 
			<!--  <p th:each="qstn ,stat : ${exam.questions}"> -->
			<!-- <h2 th:text="'Question '+ ${stat.index+1}"> </h2> -->
			</div>
			
	<div class="topnav">
		<a class="active" >Lxi Technologies</a>
  		
  		<a  th:href="@{/}">Home</a>
  		<a class="logout" th:href="@{/logoutpage}">logout</a></div>
  </div>

<div class="container">

<form id="myForm" th:object="${iterator}"  th:action="@{/user_nextPage}">

<input type="hidden" id="timer"  name="timerValue" value=${timerValue}/>


<div class="bubble-container">
	 <span th:each="qstn ,stat : ${exam.questions}">
 		<span class="bubble" th:if="${attendedOptions==null}"  th:text="${stat.index+1}" ></span>
	  		<a th:if="!${attendedOptions==null}" th:href="@{/user_nextPage(qid=${qstn.id},count=${count},aExamId=${aExamId},eId=${exam.getId()},index=${stat.index+1},timerValue=${timerValue})}" 
	  			class="bubble" th:style="${attendedOptions[__stat.index__].attendedOpt==null}?'background:#ffff99':'background:lime'" >
	  			 <span th:text="${stat.index+1}" ></span></a>
	  	</span>
		<div>
			<input type="submit" value="submit" class="button button1">
		</div>
</div>

		<div>
			<span th:text="${question.getQstn()}" th:value="${question.id}"><br>question<br> </span>
				 <span th:each="qstn_option : ${question.qstnOptions}"><br><br>
				<input type="radio" th:name="optionid"  id="'option'+${qstn_option.getId()}"   th:value="${qstn_option.getId()}"
				th:text="${qstn_option.option}" />
				</span>
		</div>
		
		<br><br><br>
		<input type="hidden" th:name="index" th:value="${iterator.nextIndex()}">
		<input type="hidden" th:name="count" th:value="${count}">
		<input type="hidden" th:name="aExamId" th:value="${aExamId}">
		<input type="hidden" th:name="eId" th:value="${exam.getId()}">
	<input type="submit" onclick="check()" class="button button1" th:value="${iterator.hasNext()}==true? next: submit" >
	<button class="button button1" onclick="goBack()">Go Back</button>
	
</form>

</div>



<script th:inline="javascript">
let urlstring = window.location.search;
let urlp=new URLSearchParams(urlstring);
let ms=urlp.get('timerValue');
let mseconds=0;
if(ms==null)
	{
	 mseconds = hourToMiliSeconds([[${exam.getTime()}]]);
	}
	else
	{
		mseconds=ms;
	}


function timer() {
	mseconds = mseconds - 1000;
  if(mseconds > 0) {
    document.getElementById('timerValue').innerHTML = millisToMinutesAndSeconds(mseconds);
		document.getElementById('timer').value = mseconds;
		 window.setTimeout("timer()" , 1000);
  } else {
	 
		alert('Timed OUt');
		document.getElementById('myForm').submit();
	}
}

function hourToMiliSeconds(hour) {
	let msecond = 0;
	let time = hour.split(':');
	msecond = (time[0] * (60000 * 60)) + (time[1] * 60000);
	return msecond;
}

function millisToMinutesAndSeconds(millis) {
  var minutes = Math.floor(millis / 60000);
  var seconds = ((millis % 60000) / 1000).toFixed(0);
  return minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
}

function goBack() {
  window.history.back();

}

timer();

	/* function check(){
	  document.getElementById("'option'+${qstn_option.getId()}").checked = true;} */
	

	

</script>


</body>


</html>